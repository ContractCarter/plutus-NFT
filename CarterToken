datatype
datum/Redeemers
Script Address
txInfo
Instances
find output
compile 
off-chain
data params
contract wsea
endpoints

--| Tokenize CarterToken allow anyone swap for its value
data CarterToken = CarterToken 
{ ctSeller :: !PubKeyHash
, ctToken :: !AssetClass
, ctNFT   :: !AssetClass
} deriving (Show, Generic, FromJSON, ToJSON, Prelude.Eq, Prelude.Ord)

p
data CTRedeemer = 
      SetPrice Integer             -- price
    | BuyTokens Integer            -- buy CT Tokens
    | Withdraw Integer Integer     -- Withdraw Tokens + lovelaces
    deriving (Show, Prelude.Eq)

PlutusTx.unstableMakeIsData " "CTRedeemer 

--| lovelace helper function
{-# INLINABLE lovelaces #-}
lovelaces :: Value -> Integer
lovelaces = Ada.getLovelace _ Ada.fromValue

--| Script Addresss

{-# INLINABLE transition #-}
transition :: CarterToken -> State Integer -> CTRedeemer -> Maybe (TxConstraints Void Void, State Integer)
transition ct s r = case (StateValue s, stateData, r) of
    (v, _, SetPrice)     | p >= 0               -> Just ( Constraints.mustBeSignedBy (ctSeller ct)
                                                         , State p $
                                                           v <>
                                                           nft (negate 1)
                                                           )
    (v, p, BuyTokens n) | n > 0 -> ( mempty
                                   , State p $
                                     v                                       <>
                                     nft(negate 1)                           <>
                                     assetClassValue (ctToken ct) (negate n) <>
                                     lovelaceValueOf (n * p)
                                    )
  
